(function(r,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(r=typeof globalThis<"u"?globalThis:r||self,a(r.Pieces={}))})(this,function(r){"use strict";class a{constructor(){this.width=0}format(t,n,i){return""}fstep(t,n,i){return""}toString(){return"Empty"}}class j{constructor(t){this.text=t,this.width=t.length}format(t,n,i){return i.column+=this.width,this.text}fstep(t,n,i){return n.column+=this.width,this.text}toString(){return JSON.stringify(this.text)}}class W{constructor(t,n){this.doc1=t,this.doc2=n,this.width=t.width}format(t,n,i){return t?this.doc1.format(!0,n,i):this.doc2.format(!1,n,i)}fstep(t,n,i){return t.doc=t.flat?this.doc1:this.doc2,null}toString(){return`(IfFlat ${this.doc1} ${this.doc2})`}}class M{constructor(){this.width=1/0}format(t,n,i){return console.assert(!t),i.line=i.line+1,i.column=n,i.lastIndent=n,`
`+" ".repeat(n)}fstep(t,n,i){return n.line=n.line+1,n.column=t.indent,n.lastIndent=t.indent,`
`+" ".repeat(t.indent)}toString(){return"HardLine"}}class N{constructor(t){this.width=t}format(t,n,i){return i.column+=this.width," ".repeat(this.width)}fstep(t,n,i){return n.column+=this.width," ".repeat(this.width)}toString(){return`(Blank ${this.width})`}}class O{constructor(t,n){this.doc1=t,this.doc2=n,this.width=t.width+n.width}format(t,n,i){const s=this.doc1.format(t,n,i),d=this.doc2.format(t,n,i);return s+d}fstep(t,n,i){return t.doc=this.doc1,i.push({type:m.Append1,doc2:this.doc2,flat:t.flat,indent:t.indent}),null}toString(){return`(Append ${this.doc1} ${this.doc2})`}}class S{constructor(t){this.doc=t,this.width=t.width}format(t,n,i){return this.doc.format(t||i.canFlatten(i.column+this.doc.width),n,i)}fstep(t,n,i){return t.doc=this.doc,t.flat=t.flat||n.canFlatten(n.column+this.doc.width),null}toString(){return`(Group ${this.doc})`}}class R{constructor(t,n){this.indent=t,this.doc=n,this.width=n.width}format(t,n,i){return this.doc.format(t,Math.max(n+this.indent,0),i)}fstep(t,n,i){return t.doc=this.doc,t.indent=Math.max(t.indent+this.indent,0),null}toString(){return`(Nest ${this.indent} ${this.doc})`}}class v{constructor(t){this.doc=t,this.width=t.width}format(t,n,i){return this.doc.format(t,i.column,i)}fstep(t,n,i){return t.doc=this.doc,t.indent=n.column,null}toString(){return`(Align ${this.doc})`}}class k{constructor(t,n,i,s,d){this.lineWidth=t,this.ribbonWidth=n,this.lastIndent=i,this.line=s,this.column=d}canFlatten(t){return t<=this.lineWidth&&t<=this.ribbonWidth+this.lastIndent}}const B=(e,t,n)=>{let i=new k(e,t,0,0,0);const s=i.canFlatten(n.width);return n.format(s,0,i)},m={Append1:0,Append2:1};function G(e,t,n){const i=e.pop();if(i.type===m.Append1)return n.doc=i.doc2,n.flat=i.flat,n.indent=i.indent,e.push({type:m.Append2,s1:t}),null;if(i.type===m.Append2)return i.s1+t}const H=(e,t,n)=>{let i=new k(e,t,0,0,0),s={doc:n,indent:0,flat:i.canFlatten(n.width)};const d=[];let w=null;for(let T=0;T<5e5;T++)if(w===null)w=s.doc.fstep(s,i,d);else{if(d.length===0)return w;w=G(d,w,s)}throw new Error("Exceeded maximum number of steps. Do you really need to pretty print that?")},c=new a,h=e=>e instanceof a,y=(e,t)=>h(e)&&h(t)?c:new W(e,t),_=e=>e===0?c:new N(e),b=new M,o=e=>y(_(e),b),K=y(_(1),b),g=e=>{if(e.length===0)return c;if(e.includes(`
`))throw new Error("Text cannot contain newline characters. Use `tabbedString` instead, which convert them to tabs.");return new j(e)},L=g,u=(e,t)=>h(e)?t:h(t)?e:new O(e,t),f=(...e)=>e.length===0?c:e.reduceRight((t,n)=>u(n,t)),A=e=>h(e)||e.width===1/0||e instanceof S?e:new S(e),l=(...e)=>e.length===1?A(e[0]):A(f(...e)),p=e=>(...t)=>{const n=f(...t);return e===0||h(n)?n:new R(e,n)},$=(...e)=>{const t=f(...e);return h(t)?c:new v(t)},P=e=>(...t)=>{if(e===0)return c;const n=f(...t);let i=n;for(let s=1;s<e;s++)i=u(i,n);return i},I=e=>(...t)=>{if(t.length===0)return c;let n=t[0];for(let i=1;i<t.length;i++)n=u(n,u(e,t[i]));return n},E=e=>e.split(`
`).map(g),D=e=>I(o(1))(...E(e)),J=e=>e.split(/\s+/).map(g),U=e=>(...t)=>t.reduce((n,i)=>u(n,l(u(e,i)))),q=e=>(...t)=>$(p(e)(...t)),F=(e,t,n)=>(...i)=>l(n,p(e)(o(t),...i)),z=(e,t)=>(...n)=>l(p(e)(o(t),...n)),C=(e,t,n,i,s)=>F(e,t,f(i,o(t),n))(s),Q=(e,t,n,i)=>(...s)=>l(n,p(e)(o(t),...s),o(t),i),V=(e,t,n,i)=>(...s)=>l(n,p(e)(l(o(t)),...s),l(o(t),i));r.align=$,r.append=f,r.append2=u,r.blank=_,r.empty=c,r.flow=U,r.group=l,r.hang=q,r.hardline=b,r.ifflat=y,r.infix=C,r.isEmpty=h,r.jump=z,r.lines=E,r.nest=p,r.prefix=F,r.pretty=H,r.prettyRec=B,r.repeat=P,r.separate=I,r.softSurround=V,r.space=K,r.surround=Q,r.t=g,r.tab=o,r.tabbedString=D,r.text=L,r.words=J,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
